#!/bin/bash
#SBATCH -J np_loop
#SBATCH -A ees240004p
#SBATCH -p RM-shared
#SBATCH -N 1
#SBATCH --cpus-per-task=32    # 32 cores -> ~64 GB (2 GB/core)
#SBATCH -t 24:00:00

module load anaconda3/2022.10
conda activate nonpareil

OUTDIR="${1:?Need output directory}"
mkdir -p "$OUTDIR"

# four sample base names (without _R1.fastq.gz)
SAMPLES=( S2_01_A S2_01_B S3_04_A S3_04_B )

for S in "${SAMPLES[@]}"; do
  echo "Processing $S"
  R1="${S}_R1.fastq.gz"

  nonpareil -s "$R1" -T kmer -f fastq \
    -b "${OUTDIR}/${S}" \
    -t 8 -R 64000

  echo "Done with $S"
done

echo "All samples finished."
